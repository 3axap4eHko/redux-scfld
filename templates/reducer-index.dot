{{=it.__warning_header}}
{{
    const reducers = {};
    it.eachEntity(it.entities, entity => reducers[entity.namespace] = it.relative(it.config.reducersPath, entity.reducerPath));
    const importReducers = Object.keys(reducers).map( namespace => `import ${namespace} from './${it.noExt(reducers[namespace])}';` ).join('\n');
    const mappedReducers = Object.keys(reducers).join(',\n  ');
    const statePath      = it.relative(it.config.reducersPath, it.config.statesPath);
}}
{{=importReducers}}
import defaultState from './{{=statePath}}';

const namespaceReducersMap = {
  {{=mappedReducers}},
};

export default function (state = defaultState, action) {
  const { namespace } = action;
  if (namespace in namespaceReducersMap) {
    const prevNamespaceState = state[namespace];
    const nextNamespaceState = namespaceReducersMap[namespace](prevNamespaceState, action);
    if (typeof nextNamespaceState === 'undefined') {
      throw new Error(`State from reducer '${<%  %>namespace}' cannot be undefined`);
    }
    if (prevNamespaceState !== nextNamespaceState) {
      return { ...state, [namespace]: nextNamespaceState };
    }
  }
  return state;
}
